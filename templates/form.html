<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kairali Onam 2025 Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        async function fetchEmails() {
            const response = await fetch("/get_emails");
            const emails = await response.json();
            const datalist = document.getElementById("emails");
            datalist.innerHTML = "";
            emails.forEach(email => {
                const option = document.createElement("option");
                option.value = email;
                datalist.appendChild(option);
            });
        }

        async function fetchUser() {
            const email = document.getElementById("email").value;
            if (!email) return;

            const response = await fetch(`/get_user?email=${email}`);
            const user = await response.json();

            if (user && Object.keys(user).length) {
                document.getElementById("first_name").value = user.first_name || "";
                document.getElementById("last_name").value = user.last_name || "";
                document.getElementById("mobile_code").value = user.mobile_code || "+91";
                document.getElementById("mobile_number").value = user.mobile_number || "";
                document.getElementById("whatsapp_code").value = user.whatsapp_code || "+91";
                document.getElementById("whatsapp_number").value = user.whatsapp_number || "";
                document.getElementById("family_members").value = user.family_members || "0";
                document.getElementById("event_fee").value = user.event_fee || "0";
                document.getElementById("membership_fee").value = user.membership_fee || "0";
                document.getElementById("donation_fee").value = user.donation_fee || "0";
            }
        }

        window.onload = fetchEmails;
    </script>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>Kairali Onam 2025 - Event Registration</h2>

    {% if message %}
        <div class="alert alert-success">{{ message }}</div>
    {% endif %}

    <form action="/submit" method="post">
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input list="emails" type="email" class="form-control" id="email" name="email"
                   value="{{ user.email }}" onchange="fetchUser()" required>
            <datalist id="emails"></datalist>
        </div>

        <div class="row">
            <div class="col mb-3">
                <label for="first_name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="first_name" name="first_name" value="{{ user.first_name }}" required>
            </div>
            <div class="col mb-3">
                <label for="last_name" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="last_name" name="last_name" value="{{ user.last_name }}" required>
            </div>
        </div>

        <div class="row">
            <div class="col mb-3">
                <label for="mobile_code" class="form-label">Mobile Code</label>
                <input type="text" class="form-control" id="mobile_code" name="mobile_code" value="{{ user.mobile_code }}" required>
            </div>
            <div class="col mb-3">
                <label for="mobile_number" class="form-label">Mobile Number</label>
                <input type="text" class="form-control" id="mobile_number" name="mobile_number" value="{{ user.mobile_number }}" required>
            </div>
        </div>

        <div class="row">
            <div class="col mb-3">
                <label for="whatsapp_code" class="form-label">WhatsApp Code</label>
                <input type="text" class="form-control" id="whatsapp_code" name="whatsapp_code" value="{{ user.whatsapp_code }}" required>
            </div>
            <div class="col mb-3">
                <label for="whatsapp_number" class="form-label">WhatsApp Number</label>
                <input type="text" class="form-control" id="whatsapp_number" name="whatsapp_number" value="{{ user.whatsapp_number }}" required>
            </div>
        </div>

        <div class="mb-3">
            <label for="family_members" class="form-label">Family Members</label>
            <input type="number" class="form-control" id="family_members" name="family_members" value="{{ user.family_members }}">
        </div>

        <div class="row">
            <div class="col mb-3">
                <label for="event_fee" class="form-label">Event Fee</label>
                <input type="number" class="form-control" id="event_fee" name="event_fee" value="{{ user.event_fee }}">
            </div>
            <div class="col mb-3">
                <label for="membership_fee" class="form-label">Membership Fee</label>
                <input type="number" class="form-control" id="membership_fee" name="membership_fee" value="{{ user.membership_fee }}">
            </div>
            <div class="col mb-3">
                <label for="donation_fee" class="form-label">Donation Fee</label>
                <input type="number" class="form-control" id="donation_fee" name="donation_fee" value="{{ user.donation_fee }}">
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Submit Registration</button>
    </form>
</div>
</body>
</html>
